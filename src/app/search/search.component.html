<div class="container search-screen">
  <header class="search-header">
    <button
      class="btn btn-link link-dark p-0 me-2"
      routerLink="/auth"
      aria-label="Retour"
    >
      ←
    </button>
    <h1 class="m-0">Rechercher</h1>
  </header>

  <form
    class="search-card"
    #searchForm="ngForm"
    (ngSubmit)="onSubmit(searchForm)"
  >
    <input
      class="form-control mb-1"
      #fromInput
      type="text"
      name="from"
      ngModel
      placeholder="De"
      required
    />
    <div class="error" *ngIf="searchForm.submitted && searchForm.controls['from']?.errors">
      {{ searchForm.controls['from']?.errors?.['required'] ? 'Champ obligatoire' : 'Lieu invalide' }}
    </div>
    <input
      class="form-control mb-1"
      #toInput
      type="text"
      name="to"
      ngModel
      placeholder="À"
      required
    />
    <div class="error" *ngIf="searchForm.submitted && searchForm.controls['to']?.errors">
      {{ searchForm.controls['to']?.errors?.['required'] ? 'Champ obligatoire' : 'Lieu invalide' }}
    </div>

    <div class="row g-2 mb-3">
      <div class="col">
        <input
          class="form-control mb-1"
          type="date"
          name="travelDate"
          ngModel
          required
          #travelDateInput
        />
        <div class="error" *ngIf="searchForm.submitted && searchForm.controls['travelDate']?.errors">
          {{ searchForm.controls['travelDate']?.errors?.['required'] ? 'Champ obligatoire' : 'La date doit être dans le futur.' }}
        </div>
      </div>
      <div class="col-auto">
        <select class="form-select" name="passengers" ngModel>
          <option *ngFor="let n of [1,2,3,4,5,6,7,8]" [value]="n">
            {{ n }} passager{{ n > 1 ? 's' : '' }}
          </option>
        </select>
      </div>
    </div>

    <div class="d-flex gap-2 align-items-center mb-3">
      <div class="form-check mb-0">
        <input
          class="form-check-input"
          type="checkbox"
          name="roundTrip"
          [(ngModel)]="roundTrip"
          id="roundTrip"
        />
        <label class="form-check-label" for="roundTrip">Aller-retour</label>
      </div>
      <div class="flex-grow-1">
        <input
          *ngIf="roundTrip"
          class="form-control mb-1"
          type="date"
          name="returnDate"
          ngModel
          [required]="roundTrip"
          #returnDateInput
        />
        <div class="error" *ngIf="roundTrip && searchForm.submitted && searchForm.controls['returnDate']?.errors">
          <ng-container *ngIf="searchForm.controls['returnDate']?.errors?.['required']; else returnDateErr">Sélectionnez une date de retour.</ng-container>
          <ng-template #returnDateErr>Retour après le départ.</ng-template>
        </div>
      </div>
    </div>

    <div class="error" *ngIf="error">{{ error }}</div>
    <button
      class="app-btn"
      type="submit"
      [disabled]="searchForm.invalid || !fromPlace || !toPlace"
    >
      Rechercher
    </button>

  </form>
    <!-- Map preview ----------------------------------------------->


    <div id="map" class="map-preview"></div>

</div>
